trigger:
  branches:
    include:
      - main

stages:
- stage: Build
  jobs:
  - job: BuildJob
    pool:
      vmImage: ubuntu-latest
    steps:
    # 1️⃣ Checkout repo
    - checkout: self
      clean: true
      fetchDepth: 0   # ensure full repo is fetched

    # 2️⃣ Debug folder structure
    - script: ls -la
      displayName: 'List root folder to debug paths'

    # 3️⃣ Build backend
    - task: NodeTool@0
      inputs:
        versionSpec: '20.x'
    - script: |
        npm install
        npm run build
      workingDirectory: backend
      displayName: 'Build Backend'

    # 4️⃣ Build frontend
    - task: NodeTool@0
      inputs:
        versionSpec: '20.x'
    - script: |
        npm install
        npm run build
      workingDirectory: frontend
      displayName: 'Build Frontend'